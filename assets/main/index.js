System.register("chunks:///_virtual/ai.ts",["cc","./NHWC.ts"],(function(t){var c,n;return{setters:[function(t){c=t.cclegacy},function(t){n=t.unow}],execute:function(){t("act",(function(t,c){for(var a=0;a<t.actionData.length;a++){var e=t.actionData[a],i=t.template.actions[a];if(0!=e.charges&&n()>=e.activeWhen)return e.activeWhen=n()+i.cooldown,e.charges--,void i.action(c,e)}})),c._RF.push({},"2056bHoSc9AZp1ZbsVj6KXv","ai",void 0),c._RF.pop()}}}));

System.register("chunks:///_virtual/Card.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NHWC.ts"],(function(t){var e,n,i,a;return{setters:[function(t){e=t.createClass},function(t){n=t.cclegacy},function(t){i=t.healPlayer,a=t.$d}],execute:function(){t({dToRange:s,simpleDamage:function(t){var e=s(t);return function(n){null!=n.detail||(n.detail=[]),n.detail.push("deal "+e.min+"-"+e.max+" damage"),n.actions.push((function(e){var n=a(t);e.pushStep({damage:{value:{raw:n},target:e.target.unit}})}))}},simpleHealing:function(t){var e=s(t);return function(n){null!=n.detail||(n.detail=[]),n.detail.push("restore "+e.min+"-"+e.max+" hitpoints"),n.actions.push((function(e){i(a(t)),e.pushStep({healPlayer:a(t)})}))}}}),n._RF.push({},"12753qz7YtCA6x1Psozdu8/","Card",void 0);t("CardTemplate",function(){function t(t,e){for(var n in this.name="",this.useCharges=-1,this.rebound=!1,this.time=4,this.detail=void 0,this.actions=new Array,this.targeting="unit",this.name=t,e)this[n]=e[n]}return t.prototype.with=function(t){return t(this),this},t}()),t("CardInstance",function(){function t(t){this.template=void 0,this.identifier=0,this.useCharges=0,this.template=t,this.useCharges=this.template.useCharges}return t.prototype.onDraw=function(){},e(t,[{key:"name",get:function(){return this.template.name}}]),t}());function s(t){var e,n,i=null!=(e=t.n)?e:1,a=null!=(n=t.bonus)?n:0;return{min:a+i,max:a+i*t.d}}n._RF.pop()}}}));

System.register("chunks:///_virtual/CombatView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HandView.ts","./Card.ts","./NHWC.ts","./UnitView.ts","./Unit.ts","./Testing.ts","./Units.ts","./OrbView.ts","./TimelineView.ts"],(function(e){var t,n,i,r,a,o,d,s,l,c,h,u,g,p,v,m,f,w,y,C,b,T,N,V,O,D,P,S,U,x,I,k,B,_,F,z,A,M,H;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy,d=e._decorator,s=e.Prefab,l=e.SpriteFrame,c=e.Node,h=e.lerp,u=e.Sprite,g=e.UITransform,p=e.Color,v=e.Label,m=e.ParticleSystem2D,f=e.Vec3,w=e.clamp,y=e.bezier,C=e.tween,b=e.Component},function(e){T=e.HandView},function(e){N=e.CardInstance},function(e){V=e.spawn,O=e.subscribe,D=e.play,P=e.pub,S=e.unow,U=e.u,x=e.shuffle,I=e.beginEncounter,k=e.draw},function(e){B=e.UnitView},function(e){_=e.isFrontRow},function(e){F=e.abilityGroups,z=e.potions},function(e){A=e.randomUnit},function(e){M=e.OrbView},function(e){H=e.TimelineView}],execute:function(){var R,L,Y,E,G,W,j,q,J;o._RF.push({},"b9157VJ0q5O4oUrxarZY/Uu","CombatView",void 0);var Z=d.ccclass,K=d.property;e("CombatView",(R=Z("CombatView"),L=K({type:s}),Y=K({type:l}),E=K({type:l}),R((j=t((W=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"card",j,r(t)),i(t,"dragDot",q,r(t)),i(t,"dragArrow",J,r(t)),t.hand=void 0,t.unitViews=new Map,t.currentTarget=null,t.encounterStarted=!1,t.arrow=void 0,t.dots=new Array,t.DOT_COUNT=15,t.playing=null,t.animating=!1,t}n(t,e);var o=t.prototype;return o.start=function(){var e=this;this.node.getChildByName("victory").active=!1,this.node.getChildByName("defeat").active=!1;for(var t,n=this.node.getChildByName("hp").getComponent(M),i=this.getComponentInChildren(H),r=a(this.node.getComponentsInChildren(B));!(t=r()).done;){var o=t.value;if(o.node.active=!1,_(o.position)){var d=V(A((function(e){return 1==e.level})),o.position);this.unitViews.set(o.position,o),o.setModel(d),o.node.active=!0}}for(var s=0;s<this.DOT_COUNT;s++){var l=s/this.DOT_COUNT,b=new c("dot."+s),I=h(.08,.15,l);b.setScale(I,I,I);var k=b.addComponent(u);k.color.set(255,255,0,255),k.spriteFrame=this.dragDot,b.active=!1,this.node.addChild(b),this.dots.push(k)}var R=new c("arrow");R.addComponent(g).anchorY=0;var L=new c("sprite");L.setScale(.1,.1,.1);var Y=L.addComponent(u);Y.spriteFrame=this.dragArrow,Y.color.set(255,255,0,200),R.addChild(L),R.active=!1,this.node.addChild(R),this.arrow=R;var E=this.node.getChildByName("hand").getComponent(T),G=this.node.getChildByName("deck"),W=this.node.getChildByName("discard");E.cardPrefab=this.card,E.discard=W,E.deck=G.getComponent(u),E.deck.color=p.GRAY,this.hand=E,O("/draw/available",(function(e){E.deck.color=e?p.WHITE:p.GRAY}));var j=G.getComponentInChildren(v),q=W.getComponentInChildren(v),J=this.node.getChildByName("time").getComponent(v);O("/encounter/complete",(function(){e.node.getChildByName("victory").active=!0;for(var t,n=a(e.node.getChildByName("victory").getComponentsInChildren(m));!(t=n()).done;){t.value.resetSystem()}})),O("/card/drag/begin",(function(e){})),O("/card/drag/end",(function(t){var n;if("none"==t.template.targeting){var r=e.hand.byId.get(t.identifier);r.node.position.y-r.peekPos.y>200&&(n={unit:void 0})}else{var o=e.currentTarget;o&&(o.border.state="normal",n={unit:o.model})}n?e.setPlaying(D(t,n)):E.byId.get(t.identifier).reset("cancel"),P("/card/deselect",t);for(var d,s=a(e.dots);!(d=s()).done;){d.value.node.active=!1}e.arrow.active=!1,e.currentTarget=null,P("/preview",null),i.highlight(null,-1)})),O("/card/drag",(function(t){var n,r=t.card,o=t.root,d=t.pos,s=!1;if("none"==r.template.targeting)s=!0;else{var l=new f(d.x,d.y,0),c=new f,h=e.node.inverseTransformPoint(new f,o);e.node.inverseTransformPoint(c,l),e.currentTarget=null;for(var u=w(h.x-c.x,-90,90),p=Math.abs(u)-90,v=[h.x,h.x,c.x+u,c.x+.3*u],m=[h.y,h.y+120,c.y+.3*p,c.y+.3*p],C=0;C<e.DOT_COUNT;C++){var b=(C+1)/(e.DOT_COUNT+1),T=y(v[0],v[1],v[2],v[3],b),N=y(m[0],m[1],m[2],m[3],b),V=e.dots[C];V.node.setPosition(T,N,0),V.node.active=!0}e.arrow.setPosition(c.x,c.y,0),e.arrow.setRotationFromEuler(0,0,u),e.arrow.active=!0;for(var O,D=a(e.unitViews.values());!(O=D()).done;){var U=O.value;if(U.node.active){var x=U.getComponent(g).contentSize;U.main.node.inverseTransformPoint(c,l),Math.abs(c.x)<x.width&&Math.abs(c.y)<x.height?(e.currentTarget=U,s=!0,U.border.state="hover"):U.border.state="normal"}}}P("/preview",s?{at:S()+r.template.time}:null),i.highlight(null==(n=e.currentTarget)?void 0:n.model,r.template.time)}));var Z=!1;O("/u/health_gained",(function(e){n.norm=e.now/U.hpMax})),O("/u/health_lost",(function(t){if(n.norm=t.now/U.hpMax,t.now<=0&&!Z){E.setDisabled(),Z=!0;var i=e.node.getChildByName("defeat"),r=i.getComponent(u),a=e.node.getComponent(g),o=i.getComponent(g);o.width=a.width,o.height=a.height;var d=r.color.clone(),s=new p(d.r,d.g,d.b,225);i.active=!0,C({value:0}).to(2,{value:1},{onUpdate:function(e){r.color=d.clone().lerp(s,e.value)},easing:"cubicOut"}).start()}})),O("/card/draw",(function(){j.string=U.deck.length.toString(),q.string=U.discard.length.toString()})),O("/card/discard",(function(){q.string=U.discard.length.toString()})),O("/time",(function(e){J.string="T: "+e}));for(var K=0;K<13;K++){var Q=new N(F.slaps[K%3]);U.deck.push(Q)}U.deck.push(new N(z.healing)),U.deck.push(new N(z.healing)),U.deck.push(new N(z.healing)),x()},o.setPlaying=function(e){console.log("playing: "+(null!=e)),this.playing=e,this.hand.setDisabled(null!=e)},o.update=function(e){this.encounterStarted||(I(),this.encounterStarted=!0);var t=this.playing;if(t&&!this.animating){var n=t.step();if(!n)return void this.setPlaying(null);n.damage,this.stallFor(.25)}1==U.hand.size&&U.hand.has(U.weapon)&&U.drawAvailable&&k(),this.hand.dragging},o.stallFor=function(e){var t=this;this.animating=!0,this.scheduleOnce((function(){return t.animating=!1}),e)},t}(b)).prototype,"card",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=t(W.prototype,"dragDot",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=t(W.prototype,"dragArrow",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G=W))||G));o._RF.pop()}}}));

System.register("chunks:///_virtual/debug-view-runtime-control.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,n,s,l,r,a,g,h,p,c,C,d,m,u,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){s=t.cclegacy,l=t._decorator,r=t.Node,a=t.Color,g=t.Canvas,h=t.UITransform,p=t.instantiate,c=t.Label,C=t.RichText,d=t.Toggle,m=t.Button,u=t.director,L=t.Component}],execute:function(){var f,M,b,v,T,S,x,E,I;s._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var A=l.ccclass,y=l.property;t("DebugViewRuntimeControl",(f=A("internal.DebugViewRuntimeControl"),M=y(r),b=y(r),v=y(r),f((x=e((S=function(t){function e(){for(var e,o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s))||this,i(e,"compositeModeToggle",x,n(e)),i(e,"singleModeToggle",E,n(e)),i(e,"EnableAllCompositeModeButton",I,n(e)),e._single=0,e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],e.compositeModeToggleList=[],e.singleModeToggleList=[],e.miscModeToggleList=[],e.textComponentList=[],e.labelComponentList=[],e.textContentList=[],e.hideButtonLabel=void 0,e._currentColorIndex=0,e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],e.color=[a.WHITE,a.BLACK,a.RED,a.GREEN,a.BLUE],e}o(e,t);var s=e.prototype;return s.start=function(){if(this.node.parent.getComponent(g)){var t=this.node.parent.getComponent(h),e=.5*t.width,o=.5*t.height,i=.1*e-e,n=o-.1*o,s=this.node.getChildByName("MiscMode"),l=p(s);l.parent=this.node,l.name="Buttons";var r=p(s);r.parent=this.node,r.name="Titles";for(var u=0;u<2;u++){var L=p(this.EnableAllCompositeModeButton.getChildByName("Label"));L.setPosition(i+(u>0?450:150),n,0),L.setScale(.75,.75,.75),L.parent=r;var f=L.getComponent(c);f.string=u?"----------Composite Mode----------":"----------Single Mode----------",f.color=a.WHITE,f.overflow=0,this.labelComponentList[this.labelComponentList.length]=f}n-=20;for(var M=0,b=0;b<this.strSingle.length;b++,M++){b===this.strSingle.length>>1&&(i+=200,M=0);var v=b?p(this.singleModeToggle):this.singleModeToggle;v.setPosition(i,n-20*M,0),v.setScale(.5,.5,.5),v.parent=this.singleModeToggle.parent;var T=v.getComponentInChildren(C);T.string=this.strSingle[b],this.textComponentList[this.textComponentList.length]=T,this.textContentList[this.textContentList.length]=T.string,v.on(d.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[b]=v}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,n,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(m.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=l;var S=this.EnableAllCompositeModeButton.getComponentInChildren(c);this.labelComponentList[this.labelComponentList.length]=S;var x=p(this.EnableAllCompositeModeButton);x.setPosition(i+90,n,0),x.setScale(.5,.5,.5),x.on(m.EventType.CLICK,this.changeTextColor,this),x.parent=l,(S=x.getComponentInChildren(c)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=S;var E=p(this.EnableAllCompositeModeButton);E.setPosition(i+200,n,0),E.setScale(.5,.5,.5),E.on(m.EventType.CLICK,this.hideUI,this),E.parent=this.node.parent,(S=E.getComponentInChildren(c)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=S,this.hideButtonLabel=S,n-=40;for(var I=0;I<this.strMisc.length;I++){var A=p(this.compositeModeToggle);A.setPosition(i,n-20*I,0),A.setScale(.5,.5,.5),A.parent=s;var y=A.getComponentInChildren(C);y.string=this.strMisc[I],this.textComponentList[this.textComponentList.length]=y,this.textContentList[this.textContentList.length]=y.string,A.getComponent(d).isChecked=!!I,A.on(d.EventType.TOGGLE,I?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[I]=A}n-=150;for(var D=0;D<this.strComposite.length;D++){var B=D?p(this.compositeModeToggle):this.compositeModeToggle;B.setPosition(i,n-20*D,0),B.setScale(.5,.5,.5),B.parent=this.compositeModeToggle.parent;var w=B.getComponentInChildren(C);w.string=this.strComposite[D],this.textComponentList[this.textComponentList.length]=w,this.textContentList[this.textContentList.length]=w.string,B.on(d.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[D]=B}}else console.error("debug-view-runtime-control should be child of Canvas")},s.isTextMatched=function(t,e){var o=new String(t),i=o.search(">");return-1===i?t===e:(o=(o=o.substr(i+1)).substr(0,o.search("<")))===e},s.toggleSingleMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strSingle.length;i++)this.isTextMatched(o.string,this.strSingle[i])&&(e.singleMode=i)},s.toggleCompositeMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strComposite.length;i++)this.isTextMatched(o.string,this.strComposite[i])&&e.enableCompositeMode(i,t.isChecked)},s.toggleLightingWithAlbedo=function(t){u.root.debugView.lightingWithAlbedo=t.isChecked},s.toggleCSMColoration=function(t){u.root.debugView.csmLayerColoration=t.isChecked},s.enableAllCompositeMode=function(t){var e=u.root.debugView;e.enableAllCompositeMode(!0);for(var o=0;o<this.compositeModeToggleList.length;o++){this.compositeModeToggleList[o].getComponent(d).isChecked=!0}var i=this.miscModeToggleList[0].getComponent(d);i.isChecked=!1,e.csmLayerColoration=!1,(i=this.miscModeToggleList[1].getComponent(d)).isChecked=!0,e.lightingWithAlbedo=!0},s.hideUI=function(t){var e=this.node.getChildByName("Titles"),o=!e.active;this.singleModeToggleList[0].parent.active=o,this.miscModeToggleList[0].parent.active=o,this.compositeModeToggleList[0].parent.active=o,this.EnableAllCompositeModeButton.parent.active=o,e.active=o,this.hideButtonLabel.string=o?"Hide UI":"Show UI"},s.changeTextColor=function(t){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var e=0;e<this.textComponentList.length;e++)this.textComponentList[e].string=this.strColor[this._currentColorIndex]+this.textContentList[e]+"</color>";for(var o=0;o<this.labelComponentList.length;o++)this.labelComponentList[o].color=this.color[this._currentColorIndex]},s.onLoad=function(){},s.update=function(t){},e}(L)).prototype,"compositeModeToggle",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(S.prototype,"singleModeToggle",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(S.prototype,"EnableAllCompositeModeButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=S))||T));s._RF.pop()}}}));

System.register("chunks:///_virtual/FrameBorder.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,o,i,s,a,l,c,h,u,p,m,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,i=e.createClass,s=e.classPrivateFieldLooseBase,a=e.classPrivateFieldLooseKey},function(e){l=e.cclegacy,c=e._decorator,h=e.Sprite,u=e.UITransform,p=e.tween,m=e.Color,d=e.Component}],execute:function(){var f,b,y,v,w,g,C,T;l._RF.push({},"dc823Xhg5pKZ4xsrJyDkVtT","FrameBorder",void 0);var F=c.ccclass,k=c.property;e("FrameBorder",(f=F("FrameBorder"),b=k({type:h}),y=k({type:Number}),f((T=a("state"),g=t((w=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return t=e.call.apply(e,[this].concat(i))||this,n(t,"main",g,o(t)),t.me=void 0,n(t,"borderThickness",C,o(t)),t.currentTween=null,Object.defineProperty(o(t),T,{writable:!0,value:"normal"}),t}r(t,e);var a=t.prototype;return a.start=function(){var e=this.node.getComponent(u),t=this.main.getComponent(u),r=2*this.borderThickness;e.setContentSize(t.contentSize.x+r,t.contentSize.y+r),0==e.anchorY&&this.node.position.set(0,-this.borderThickness),this.me=this.getComponent(h),this.me.enabled=!1},a.tweenColor=function(e,t,r){var n=this,o={alpha:this.me.color.r,stage:this.me.color.g};return this.currentTween=p(o).to(.12,{alpha:e,stage:t},{onUpdate:function(){n.me.color=new m(o.alpha,o.stage,0,1)},onComplete:r}).start(),this.currentTween},i(t,[{key:"state",set:function(e){var t,r=this;e!=s(this,T)[T]&&(s(this,T)[T]=e,null==(t=this.currentTween)||t.stop(),"hover"==e?(this.me.enabled=!0,this.tweenColor(255,25)):"down"==e?this.tweenColor(255,51):"normal"==e&&this.tweenColor(0,25,(function(){return r.me.enabled=!1})))}}]),t}(d)).prototype,"main",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=t(w.prototype,"borderThickness",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),v=w))||v));l._RF.pop()}}}));

System.register("chunks:///_virtual/Hand.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NHWC.ts"],(function(t){var r,e,n,i;return{setters:[function(t){r=t.createForOfIteratorHelperLoose,e=t.createClass},function(t){n=t.cclegacy},function(t){i=t.pub}],execute:function(){var a;n._RF.push({},"dc76bg7E1VGsoxRSH2BBp9O","Hand",void 0),a=Symbol.iterator,t("Hand",function(){function t(){this.maxSize=8,this.cards=new Array}var n=t.prototype;return n.has=function(t){for(var e,n=r(this.cards);!(e=n()).done;){if(e.value.template===t)return!0}return!1},n.remove=function(t,r){var e=this.cards.findIndex((function(r){return r==t}));if(e<0)throw"card not in hand";this.cards.splice(e,1),i("/card/remove_from_hand",{card:t,fate:r})},n.add=function(r){r.identifier=t.nextId++,this.cards.push(r)},n[a]=function(){return this.cards[Symbol.iterator]()},e(t,[{key:"isEmpty",get:function(){return 0==this.cards.length}},{key:"size",get:function(){return this.cards.length}}]),t}()).nextId=1,n._RF.pop()}}}));

System.register("chunks:///_virtual/HandCardView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NHWC.ts","./HandView.ts","./FrameBorder.ts"],(function(e){var o,t,n,i,r,s,a,l,d,h,c,u,p,g,v,f,m,b,w,y,E,O;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.createClass,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,s=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,l=e._decorator,d=e.Sprite,h=e.Label,c=e.RichText,u=e.Node,p=e.input,g=e.Input,v=e.Tween,f=e.tween,m=e.Vec3,b=e.UITransform,w=e.Component},function(e){y=e.pub},function(e){E=e.HandView},function(e){O=e.FrameBorder}],execute:function(){var S,P,U,C,T,k,D,x,I,H,_;a._RF.push({},"9b358eu9UdAgYgN5OoaH4B8","HandCardView",void 0);var B=l.ccclass,L=l.property,M=(e("HandCardView",(S=B("HandCardView"),P=L({type:d}),U=L({type:h}),C=L({type:c}),T=L({type:h}),S((x=o((D=function(e){function o(){for(var o,t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return(o=e.call.apply(e,[this].concat(n))||this).hover=new M,i(o,"frame",x,r(o)),i(o,"title",I,r(o)),i(o,"details",H,r(o)),i(o,"cost",_,r(o)),o.handIndex=0,o.owner=void 0,o.model=void 0,o.originalPos=void 0,o.originalScale=void 0,o.peekPos=void 0,o.moved=!1,o.border=void 0,o.resetOnStart="cancel",o.ready=!1,o.onResetComplete=void 0,o}n(o,e);var a=o.prototype;return a.onDestroy=function(){v.stopAllByTarget(this.node)},a.kill=function(e){var o=this;if(this.hover.onExit(),this.hover.enabled=!1,v.stopAllByTarget(this.node),"destroy"==e||"retain"==e){this.node.getChildByName("cost_badge").destroy(),this.node.getChildByName("cost").destroy();var t=this.frame.color.clone(),n={value:this.frame.color.r};f(n).to(.2,{value:255},{onUpdate:function(e,n){t.r=e.value,o.frame.color=t},onComplete:function(){o.node.destroy()}}).start()}else{var i=this.owner.node.inverseTransformPoint(new m,this.owner.discard.worldPosition);f(this.node).to(.24,{position:i,scale:m.ZERO},{easing:"cubicOut"}).destroySelf().start()}},a.playThenKill=function(e){var o=this;this.hover.onExit(),this.hover.enabled=!1;var t=this.node;v.stopAllByTarget(t),"destroy"!=e?f(t).to(.2,{position:this.peekPos.add3f(0,60,0),scale:this.originalScale.multiplyScalar(1.1)},{onComplete:function(){return o.kill(e)}}).start():this.kill(e)},a.syncWithHand=function(e,o,t){this.handIndex=e;var n=this.node;if(this.originalPos=new m(o,0,0),this.originalScale=new m(.8,.8,.8),"none"!=t||this.ready)if("instant"==t)n.position=this.originalPos.clone();else{var i="fast"==t?.06:.16;f(n).to(i,{position:this.originalPos},{easing:"cubicOut"}).start()}else;this.peekPos=this.originalPos.clone().add3f(0,42,0),this.owner=n.parent.getComponent(E)},a.start=function(){var e,o,t,n,i=this,r=this.node,a=new m;this.title.string=null!=(e=null==(o=this.model)?void 0:o.name)?e:"Panic!",this.cost.string=null!=(t=null==(n=this.model)||null==(n=n.template)?void 0:n.time.toString())?t:"-",this.border=r.getComponentInChildren(O);for(var l,d=[],h=s(this.model.template.detail);!(l=h()).done;){var c=l.value;d.push(c)}this.model.template.rebound&&d.push("<bold>rebound</bold>"),this.details.string=d.join("\n"),this.hover.install(this.frame.node),this.hover.enabled=!1,this.hover.onEnter=function(){i.border.state="hover",v.stopAllByTarget(i.node),f(r).to(.12,{position:i.peekPos},{easing:"expoOut"}).start(),r.setSiblingIndex(r.parent.children.length-1),y("/card/select",i.model)},this.hover.onDown=function(e){r.parent.inverseTransformPoint(a,new m(e.getUILocationX(),e.getUILocationY(),0)),i.owner.dragging=i,a.subtract(r.position),i.border.state="down",y("/card/drag/begin",i.model)},this.hover.onUp=function(){i.border.state="hover",v.stopAllByTarget(r),y("/card/drag/end",i.model)},this.hover.onExit=function(){i.border.state="normal",f(r).to(.12,{position:i.originalPos},{easing:"expoOut"}).start(),y("/card/deselect",i.model)},this.hover.onDrag=function(e){var o=r.parent.inverseTransformPoint(new m,new m(e.getUILocationX(),e.getUILocationY(),0)),t=o.clone().subtract(a);"none"==i.model.template.targeting&&(r.position=t);o.x,i.originalPos.x;y("/card/drag",{card:i.model,root:r.worldPosition.clone().add3f(0,.8*i.frame.getComponent(b).contentSize.height,0),pos:e.getUILocation()}),i.moved=!0},this.hover.enabled=!1,"cancel"!=this.resetOnStart&&this.reset(this.resetOnStart,this.onResetComplete)},a.resetSoon=function(e,o){this.onResetComplete=o,this.resetOnStart=e},a.reset=function(e,o){var t=this;this.ready=!0,this.owner.dragging==this&&(this.owner.dragging=null),this.border.state="normal",this.hover.noOver=!0,this.hover.enabled=!1;var n=this.node.position.clone().add3f(100,30,0),i=function(){t.hover.enabled=!0,null==o||o()};"deck"==e?f(this.node).to(.2,{position:n,scale:this.originalScale.clone().multiplyScalar(.8)},{easing:"quadIn"}).to(.2,{position:this.originalPos,scale:this.originalScale},{easing:"linear",onComplete:i}).start():"weapon"==e?f(this.node).set({position:this.originalPos.clone().add3f(0,200,0)}).to(.3,{position:this.originalPos,scale:this.originalScale},{easing:"cubicOut",onComplete:i}).start():f(this.node).to(.15,{position:this.originalPos,scale:this.originalScale},{easing:"expoOut",onComplete:i}).start()},t(o,[{key:"selected",get:function(){return this.hover.down}}]),o}(w)).prototype,"frame",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=o(D.prototype,"title",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=o(D.prototype,"details",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=o(D.prototype,"cost",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=D))||k)),e("Hoverable",function(){function e(e){void 0===e&&(e=!0),this.noOver=!1,this.enableDrag=void 0,this.disabled=!1,this.enabled=!0,this.down=!1,this.over=!1,this.onDrag=void 0,this.onDown=void 0,this.onUp=void 0,this.onEnter=void 0,this.onExit=void 0,this.enableDrag=e}return e.prototype.install=function(e){var o=this;e.on(u.EventType.MOUSE_ENTER,(function(e){o.ok&&!o.down&&(o.over=!0,null==o.onEnter||o.onEnter())})),e.on(u.EventType.MOUSE_LEAVE,(function(e){o.ok&&!o.down&&(o.over=!1,o.down=!1,null==o.onExit||o.onExit())})),e.on(u.EventType.MOUSE_MOVE,(function(e){o.ok&&(o.down?null==o.onDrag||o.onDrag(e):o.noOver?(o.over=!1,o.noOver=!1):o.over||(o.over=!0,null==o.onEnter||o.onEnter()))})),this.enableDrag&&(e.on(u.EventType.MOUSE_DOWN,(function(e){o.ok&&!o.down&&(o.down=!0,null==o.onDown||o.onDown(e))})),e.on(u.EventType.MOUSE_UP,(function(e){o.ok&&o.down&&(o.down=!1,null==o.onUp||o.onUp())})),p.on(g.EventType.MOUSE_MOVE,(function(e){o.ok&&o.down&&(null==o.onDrag||o.onDrag(e))})),p.on(g.EventType.MOUSE_UP,(function(e){o.ok&&o.down&&(o.down=!1,null==o.onUp||o.onUp())})))},t(e,[{key:"ok",get:function(){return this.enabled&&!this.disabled}}]),e}()));a._RF.pop()}}}));

System.register("chunks:///_virtual/HandView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HandCardView.ts","./NHWC.ts"],(function(e){var n,r,a,i,t,o,s,d,c,u,l,v;return{setters:[function(e){n=e.inheritsLoose,r=e.createForOfIteratorHelperLoose,a=e.classPrivateFieldLooseBase,i=e.createClass,t=e.classPrivateFieldLooseKey,o=e.assertThisInitialized},function(e){s=e.cclegacy,d=e._decorator,c=e.instantiate,u=e.Component},function(e){l=e.HandCardView},function(e){v=e.subscribe}],execute:function(){var h,f;s._RF.push({},"d82c8vJNypG9Y+r7oCcB3lp","HandView",void 0);var g=d.ccclass;d.property,e("HandView",g("HandView")((f=t("dragging"),h=function(e){function t(){for(var n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=e.call.apply(e,[this].concat(a))||this).cards=new Array,n.cardPrefab=void 0,n.byId=new Map,n.deck=void 0,n.discard=void 0,n.model=void 0,n.animQueue=[],n.animPlaying=!1,Object.defineProperty(o(n),f,{writable:!0,value:null}),n}n(t,e);var s=t.prototype;return s.setDisabled=function(e){for(var n,a=r(this.cards);!(n=a()).done;){n.value.hover.disabled=e}},s.start=function(){var e=this;v("/card/remove_from_hand",(function(n){var r=e.byId.get(n.card.identifier);e.cards.splice(r.handIndex,1),e.dragging=null,e.rearrange("fast"),r.playThenKill(n.fate)})),v("/card/draw",(function(n){for(var a,i=new Array,t=r(n.cards);!(a=t()).done;){var o=a.value,s=e.add(o,n.source);s.node.active=!1,i.push(s)}if(i.reverse(),"deck"==n.source){e.animQueue.push((function(){e.rearrange("none");for(var r=.04,a=function(){var a=i[t];a.node.active=!0,a.node.scale.set(.1,.1,.1);var o=t==i.length-1?function(){return e.animPlaying=!1}:void 0;e.scheduleOnce((function(){a.reset(n.source,o)}),r),r+=.08},t=0;t<i.length;t++)a()}))}else{e.animQueue.push((function(){e.rearrange("none"),i[0].node.active=!0,i[0].resetSoon(n.source,(function(){return e.animPlaying=!1}))}))}})),document.getElementById("GameDiv").addEventListener("mouseleave",(function(n){a(e,f)[f]&&(a(e,f)[f].hover.down=!1,a(e,f)[f].hover.onUp())}))},s.update=function(e){if(!this.animPlaying&&this.animQueue.length>0){this.animPlaying=!0;var n=this.animQueue[0];this.animQueue.splice(0,1),n()}},s.add=function(e,n){var r=c(this.cardPrefab),a=r.getComponent(l);return this.node.addChild(r),a.model=e,"deck"==n&&this.node.inverseTransformPoint(r.position,this.deck.node.worldPosition),this.cards.push(a),this.byId.set(e.identifier,a),a},s.rearrange=function(e){for(var n=this.cards.length,r=-n/2*150+75,a=0;a<n;a++){this.cards[a].syncWithHand(a,r+150*a,e)}},i(t,[{key:"dragging",get:function(){return a(this,f)[f]},set:function(e){if(a(this,f)[f]=e,e)for(var n,i=r(this.cards);!(n=i()).done;){var t=n.value;t!=e&&(t.hover.enabled=!1)}else for(var o,s=r(this.cards);!(o=s()).done;){o.value.hover.enabled=!0}}}]),t}(u)))||h);s._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./debug-view-runtime-control.ts","./CombatView.ts","./FrameBorder.ts","./HandCardView.ts","./HandView.ts","./OrbView.ts","./TimelineView.ts","./UnitGallery.ts","./UnitView.ts","./Card.ts","./Hand.ts","./NHWC.ts","./PlayConductor.ts","./Unit.ts","./Units.ts","./ai.ts","./Testing.ts","./Weapons.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/NHWC.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Card.ts","./Weapons.ts","./Hand.ts","./PlayConductor.ts","./Unit.ts"],(function(n){var e,t,a,r,i,o,u,d,c,s;return{setters:[function(n){e=n.classPrivateFieldLooseBase,t=n.createClass,a=n.createForOfIteratorHelperLoose,r=n.classPrivateFieldLooseKey},function(n){i=n.cclegacy},function(n){o=n.CardInstance},function(n){u=n.weapons},function(n){d=n.Hand},function(n){c=n.PlayConductor},function(n){s=n.Unit}],execute:function(){n({$d:I,advertise:function(n){return new k(n)},allUnits:p,beginEncounter:function(){x.hand.has(x.weapon)||H();x.hand.size<x.drawCount&&M(x.drawCount-x.hand.size);for(var n,e=a(p());!(n=e()).done;){var t=n.value;t.nextAction>h&&y("/sched/unit",{unit:t,when:t.nextAction})}P=!0,x.scheduleDraw()},damagePlayer:function(n){var e=x.hp;n.actual=n.raw,x.hp-=n.actual,y("/u/health_lost",{before:e,now:x.hp,damage:n})},damageUnit:function(n,e){var t=n.hp;e.actual=e.raw,n.hp-=e.actual,y("/unit/health_lost",{unit:n,before:t,now:n.hp,damage:e}),n.invalidate()},draw:function(){var n=x.hand.maxSize-x.hand.size,e=Math.min(n,x.drawCount);e=Math.min(e,x.available),x.drawAvailable=!1,x.scheduleDraw(),M(e)},healPlayer:function(n){var e=x.hp;x.hp=Math.min(e+n,x.hpMax),y("/u/health_gained",{before:e,now:x.hp,amount:n})},makeWeapon:H,play:function(n,e){return new c(n,e)},pub:y,rn1:function(n,e){return W(n)+e},rn2:W,rna:function(n){return n[W(n.length)]},rnd:j,rne3:function(){var n=W(81);if(n<1)return 5;if(n<3)return 4;if(n<7)return 3;if(n<19)return 2;return 1},shuffle:C,spawn:function(n,e){var t=new s(n);t.position=e,t.template.speed>0&&(t.nextAction=h+t.template.speed+I($));P&&t.nextAction>h&&y("/sched/unit",{unit:t,when:t.nextAction});return t.identifier=A++,f.set(e,t),t},subscribe:m,unow:function(){return h},ustep:function(){return++h}}),i._RF.push({},"981eePNGV5LHY9QvBjHpVq0","NHWC",void 0);var h=0,l=n("NHWC",(function(){})),f=(new Array,new Map);function p(){return f.values()}var v=r("nextDraw"),w=r("drawAvailable"),g=n("Player",function(){function n(){this.drawInterval=20,this.drawCount=5,this.hand=new d,this.deck=new Array,this.discard=new Array,Object.defineProperty(this,v,{writable:!0,value:0}),Object.defineProperty(this,w,{writable:!0,value:!1}),this.hpMax=16,this.hp=this.hpMax,this.weapon=u.fists}return n.prototype.scheduleDraw=function(){e(this,v)[v]=h+this.drawInterval,y("/sched/draw",this.nextDraw)},t(n,[{key:"drawAvailable",get:function(){return e(this,w)[w]},set:function(n){e(this,w)[w]=n,y("/draw/available",n)}},{key:"nextDraw",get:function(){return e(this,v)[v]}},{key:"available",get:function(){return this.deck.length+this.discard.length}}]),n}()),b=new Map;function y(n,e){var t=b.get(n);if((null==t?void 0:t.length)>0)for(var r,i=a(t);!(r=i()).done;){(0,r.value)(e)}}var k=n("Publisher",function(){function n(n){this.topic=void 0,this.topic=n}return n.prototype.pub=function(n){y(this.topic,n)},n}());function m(n,e){var t,a=null!=(t=b.get(n))?t:[];0==a.length&&b.set(n,a),a.push(e)}var x=n("u",new g);n("g",new l);function C(){for(var n,e=a(x.discard);!(n=e()).done;){var t=n.value;x.deck.push(t)}x.discard.length=0,function(n){for(var e=n.length-1;e>0;e--){var t=Math.floor(Math.random()*(e+1)),a=n[e];n[e]=n[t],n[t]=a}}(x.deck)}function M(n){for(var e=[],t=0;t<n;t++){if(0==x.deck.length){if(0==x.discard.length)break;C()}var a=x.deck[x.deck.length-1];x.deck.length--,a.onDraw(),x.hand.add(a),e.push(a)}y("/card/draw",{cards:e,source:"deck"})}var P=!1,A=1,$={n:2,d:3};function H(){var n=new o(x.weapon);x.hand.add(n),y("/card/draw",{cards:[n],source:"weapon"})}var D,_,z,F,L=(D=1,_=1,z=1,F=1,function(){var n=((D|=0)+(_|=0)|0)+(F|=0)|0;return F=F+1|0,D=_^_>>>9,_=(z|=0)+(z<<3)|0,z=(z=z<<21|z>>>11)+n|0,(n>>>0)/4294967296});function W(n){return Math.floor(L()*n)}function j(n){return W(n)+1}function I(n){for(var e,t,a=0,r=null!=(e=n.n)?e:1,i=null!=(t=n.bonus)?t:0,o=0;o<r;o++)a+=j(n.d);return a+i}m("/unit/death",(function(n){f.delete(n.position),0==f.size&&y("/encounter/complete",!0)}));n("$d2",{n:1,d:2}),n("$d3",{n:1,d:3}),n("$d4",{n:1,d:4}),n("$d6",{n:1,d:6}),n("$d8",{n:1,d:8}),n("$2d2",{n:2,d:2}),n("$2d3",{n:2,d:3}),n("$2d4",{n:2,d:4}),n("$2d6",{n:2,d:6}),n("$2d8",{n:2,d:8});i._RF.pop()}}}));

System.register("chunks:///_virtual/OrbView.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,r,i,s,o,a,c;return{setters:[function(t){e=t.inheritsLoose,n=t.createClass},function(t){r=t.cclegacy,i=t._decorator,s=t.Graphics,o=t.UITransform,a=t.tween,c=t.Component}],execute:function(){var u;r._RF.push({},"4a9381QHu1Pe7GpVAfP7bZL","OrbView",void 0);var l=i.ccclass;i.property,t("OrbView",l("OrbView")(u=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).mask=void 0,e.current=1,e.currentTween=null,e}e(r,t);var i=r.prototype;return i.start=function(){},i.update=function(t){},n(r,[{key:"value",get:function(){return this.current},set:function(t){this.current=t,this.mask=this.node.getChildByName("Mask").getComponent(s);var e=this.node.getChildByName("Mask").getComponent(o).contentSize.height;this.mask.clear(),this.mask.lineWidth=10,this.mask.fillColor.fromHEX("#ff0000"),this.mask.fillRect(-120,-e/2,240,e*t)}},{key:"norm",set:function(t){var e;null==(e=this.currentTween)||e.stop(),this.currentTween=a(this).to(.1,{value:t}).start()}}]),r}(c))||u);r._RF.pop()}}}));

System.register("chunks:///_virtual/PlayConductor.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ai.ts","./NHWC.ts"],(function(t){var e,i,a,n,s,r,h,o,c,d,u,l;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){i=t.cclegacy},function(t){a=t.act},function(t){n=t.unow,s=t.ustep,r=t.allUnits,h=t.pub,o=t.u,c=t.makeWeapon,d=t.damageUnit,u=t.damagePlayer,l=t.healPlayer}],execute:function(){i._RF.push({},"243539qCx1L3rq71QQXSKDI","PlayConductor",void 0);t("PlayConductor",function(){function t(t,e){this.card=void 0,this.target=void 0,this.unit=void 0,this.nextAction=0,this.steps=new Array,this.cards=new Array,this.mode="executingActions",this.advanceTo=void 0,this.publishTime=!1,this.pushCard(t,e)}var i=t.prototype;return i.advanceTime=function(){if(n()==this.advanceTo)return this.mode="executingActions",void this.playNextAction();this.publishTime=!0;for(var t=n();t<this.advanceTo;){t=s();for(var i,c=e(r());!(i=c()).done;){var d=i.value;if(d.nextAction==t)return this.unit=d,a(d,this),this.unit=null,this.pushStep({enemyAction:!0}),d.nextAction=t+d.template.speed,h("/sched/unit",{unit:d,when:d.nextAction}),void h("/unit/act",d)}if(o.nextDraw==t)return o.drawAvailable=!0,void this.pushStep({drawAvailable:!0})}},i.playNextAction=function(){if(0!=this.cards.length){var t=this.cards[this.cards.length-1];if(t.actionIndex>=t.card.template.actions.length)return this.cards.length--,this.advanceTo=n()+t.card.template.time,this.mode="advancing",void this.advanceTime();var e=t.card;this.card=e,this.target=t.target,0==t.actionIndex&&(e.useCharges--,h("/card/played",e),0==e.useCharges?o.hand.remove(e,"destroy"):e.template.rebound?(o.hand.remove(e,"retain"),c()):(o.discard.push(e),o.hand.remove(e,"discard"),h("/card/discard",{card:e,why:"play"}))),e.template.actions[t.actionIndex++](this)}},i.step=function(){if(this.publishTime&&(h("/time",n()),this.publishTime=!1),0==this.steps.length&&("executingActions"==this.mode?this.playNextAction():this.advanceTime()),0==this.steps.length)return this.publishTime&&h("/time",n()),null;var t=this.steps[this.steps.length-1];return t.damage&&d(t.damage.target,t.damage.value),t.damagePlayer&&u(t.damagePlayer.value),t.healPlayer&&l(t.healPlayer),this.steps.length--,t},i.pushStep=function(t){this.steps.push(t)},i.pushCard=function(t,e){this.cards.push({card:t,target:e,actionIndex:0})},i._old=function(){},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/Testing.ts",["cc","./Card.ts","./NHWC.ts"],(function(e){var t,i,a,n,s,l;return{setters:[function(e){t=e.cclegacy},function(e){i=e.CardTemplate,a=e.simpleDamage,n=e.simpleHealing},function(e){s=e.$d6,l=e.$2d4}],execute:function(){t._RF.push({},"4e7c7yrAx9NRpOZC0kV+Zpl","Testing",void 0);var p=e("testing",{slap:new i("slap",{}).with(a(s)),lightSlap:new i("light.slap",{time:2}).with(a({d:2,bonus:1})),heavySlap:new i("heavy.slap",{time:6}).with(a(l))});e("potions",{healing:new i("potion of healing",{time:2,useCharges:1,targeting:"none"}).with(n(s))}),e("abilityGroups",{slaps:[p.slap,p.lightSlap,p.heavySlap]});t._RF.pop()}}}));

System.register("chunks:///_virtual/TimelineView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NHWC.ts"],(function(e){var n,i,t,o,r,a,l,s,u,p,c,d,h,f,m,b,w,v,g;return{setters:[function(e){n=e.applyDecoratedDescriptor,i=e.inheritsLoose,t=e.initializerDefineProperty,o=e.assertThisInitialized,r=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,l=e._decorator,s=e.Prefab,u=e.Node,p=e.Sprite,c=e.Color,d=e.Label,h=e.UITransform,f=e.instantiate,m=e.tween,b=e.Vec3,w=e.Component},function(e){v=e.subscribe,g=e.unow}],execute:function(){var y,C,z,L,I,P,R,T,A;a._RF.push({},"25bf4acDIdN/IkleXB2mfgQ","TimelineView",void 0);var V=l.ccclass,D=l.property;e("TimelineView",(y=V("TimelineView"),C=D({type:s}),z=D({type:s}),L=D({type:u}),y((R=n((P=function(e){function n(){for(var n,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return n=e.call.apply(e,[this].concat(r))||this,t(n,"drawCardPrefab",R,o(n)),t(n,"unitGoPrefab",T,o(n)),t(n,"preview",A,o(n)),n.previewLabel=void 0,n.bounds=void 0,n.horizon=20,n.upcoming=new Array,n}i(n,e);var a=n.prototype;return a.highlight=function(e,n){for(var i,t=r(this.upcoming);!(i=t()).done;){var o=i.value;e&&o.unit===e?o.node.getComponentInChildren(p).color=c.YELLOW:o.node.getComponentInChildren(p).color=c.WHITE}},a.start=function(){var e=this;this.previewLabel=this.preview.getComponentInChildren(d),this.previewLabel.enabled=!1,this.bounds=this.node.getComponent(h),v("/time",(function(n){e.sync()})),v("/unit/death",(function(n){for(var i=0;i<e.upcoming.length;i++){var t=e.upcoming[i];if(t.unit===n)return t.node.destroy(),void e.upcoming.splice(i,1)}})),v("/sched/unit",(function(n){var i=f(e.unitGoPrefab),t=n.when;i.position.set(0,e.normalizeAbs(t),0),i.getChildByName("name").getComponent(d).string=n.unit.name+" ("+n.unit.position+")",e.node.addChild(i),e.upcoming.push({node:i,when:t,unit:n.unit})})),v("/sched/draw",(function(n){var i=f(e.drawCardPrefab);i.position.set(0,e.normalizeAbs(n),0),e.node.addChild(i),e.upcoming.push({node:i,when:n})})),v("/card/select",(function(n){var i=e.normalizeRel(n.template.time);e.preview.position=e.preview.position.set(0,i,0),e.previewLabel.enabled=!0})),v("/card/deselect",(function(n){e.previewLabel.enabled=!1}))},a.sync=function(){for(var e,n=[],i=g(),t=r(this.upcoming);!(e=t()).done;){var o=e.value;o.when>i?(n.push(o),m(o.node).to(.1,{position:new b(0,this.normalizeRel(o.when-i),0)}).start()):m(o.node).to(.1,{position:new b(0,this.normalizeRel(o.when-i),0)}).destroySelf().start()}this.upcoming=n},a.normalizeAbs=function(e){return this.normalizeRel(e-g())},a.normalizeRel=function(e){return e/this.horizon*this.bounds.contentSize.height},n}(w)).prototype,"drawCardPrefab",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=n(P.prototype,"unitGoPrefab",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=n(P.prototype,"preview",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=P))||I));a._RF.pop()}}}));

System.register("chunks:///_virtual/Unit.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NHWC.ts"],(function(t){var i,n,e,s;return{setters:[function(t){i=t.createClass},function(t){n=t.cclegacy},function(t){e=t.pub,s=t.unow}],execute:function(){t({isBackRow:function(t){return"Q"==t||"W"==t||"E"==t},isFrontRow:function(t){return"A"==t||"S"==t||"D"==t}}),n._RF.push({},"5881ej/xrBNxpVGD8irdHPO","Unit",void 0);t("UnitActionData",(function(){this.activeWhen=void 0,this.charges=void 0})),t("UnitTemplate",function(){function t(t,i){for(var n in this.name="",this.speed=12,this.level=1,this.hpMax=1,this.actions=new Array,this.name=t,i)this[n]=i[n]}return t.prototype.withAction=function(t){return this.actions.push(t),this},t}()),t("Unit",function(){function t(t){this.template=void 0,this.actionData=void 0,this.onInvalidate=void 0,this.hp=void 0,this.nextAction=0,this.identifier=0,this.position="S",this.template=t,this.actionData=t.actions.map((function(t){return{activeWhen:s()+t.delay,charges:t.charges}})),this.hp=this.template.hpMax}var n=t.prototype;return n.invalidate=function(){var t;null==(t=this.onInvalidate)||t.call(this),this.hp<0&&this.kill()},n.kill=function(){e("/unit/death",this)},i(t,[{key:"hpNorm",get:function(){return this.hp/this.template.hpMax}},{key:"name",get:function(){return this.template.name}}]),t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/UnitGallery.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,t,n,i,o,c;return{setters:[function(e){r=e.inheritsLoose},function(e){t=e.cclegacy,n=e._decorator,i=e.resources,o=e.SpriteFrame,c=e.Component}],execute:function(){var s;t._RF.push({},"d14526HSJpJCIbLiHZQivdd","UnitGallery",void 0);var l=n.ccclass;n.property,e("UnitGallery",l("UnitGallery")(s=function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t.load=function(e,r){var t=e.replace(".","_");i.load("sprites/units/"+t+"/spriteFrame",o,(function(e,t){r(t)}))},t}(c))||s);t._RF.pop()}}}));

System.register("chunks:///_virtual/Units.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NHWC.ts","./Unit.ts"],(function(e){var n,t,i,o,r,a,c,u;return{setters:[function(e){n=e.createForOfIteratorHelperLoose},function(e){t=e.cclegacy},function(e){i=e.$d,o=e.$2d3,r=e.$d6,a=e.rna,c=e.$d3},function(e){u=e.UnitTemplate}],execute:function(){e({randomUnit:function(e){for(var t,i=[],o=n(Object.getOwnPropertyNames(s));!(t=o()).done;){var r=t.value,c=s[r];e(c)&&i.push(c)}if(0==i.length)throw"no valid candidates";return a(i)},simpleDamageAction:d}),t._RF.push({},"c8fdczREJFDaJh57UOg411e","Units",void 0);var s=e("units",{newt:new u("newt",{hpMax:10}).withAction(d(c)),goblin:new u("goblin",{hpMax:12,speed:14}).withAction(d(o)),caveSpider:new u("cave.spider",{hpMax:12,speed:10}).withAction(d(r))});function d(e){return{action:function(n){return n.pushStep({damagePlayer:{unit:n.unit,value:{raw:i(e)}}})},charges:-1,cooldown:-1,delay:0}}t._RF.pop()}}}));

System.register("chunks:///_virtual/UnitView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HandCardView.ts","./FrameBorder.ts","./OrbView.ts","./NHWC.ts","./UnitGallery.ts"],(function(e){var t,n,i,o,r,l,a,s,c,d,u,h,m,p,g,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){r=e.cclegacy,l=e._decorator,a=e.Sprite,s=e.Label,c=e.Color,d=e.tween,u=e.Component},function(e){h=e.Hoverable},function(e){m=e.FrameBorder},function(e){p=e.OrbView},function(e){g=e.subscribe},function(e){b=e.UnitGallery}],execute:function(){var f,v,y,w,C,B,A;r._RF.push({},"18c35RnCDlHMIMIswOLyh0g","UnitView",void 0);var N=l.ccclass,O=l.property;e("UnitView",(f=N("UnitView"),v=O({type:String}),y=O({type:a}),f((B=t((C=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return t=e.call.apply(e,[this].concat(r))||this,i(t,"position",B,o(t)),i(t,"main",A,o(t)),t.hover=new h(!1),t.border=void 0,t.willAct=void 0,t.model=void 0,t.hpOrb=void 0,t.numberBadge=void 0,t.numberLabel=void 0,t}n(t,e);var r=t.prototype;return r.sync=function(){var e=this;this.node.getChildByName("title").getComponent(s).string=this.model.name+" ("+this.position+")",this.model.onInvalidate=function(){return e.onModelChanged()},this.hpOrb=this.node.getChildByPath("frame/orb").getComponent(p),b.load(this.model.template.name,(function(t){e.node.getChildByName("portrait").getComponent(a).spriteFrame=t}))},r.setModel=function(e){this.model=e,this.node.active&&this.sync()},r.start=function(){var e=this;this.border=this.node.getComponentInChildren(m),this.numberBadge=this.node.getChildByName("number").getComponent(a),this.numberLabel=this.numberBadge.getComponentInChildren(s),this.willAct=this.node.getChildByName("willAct").getComponent(s);var t=this.willAct.color.clone(),n=new c(t.r,t.g,t.b,255);g("/preview",(function(t){var i;t&&t.at>=(null==(i=e.model)?void 0:i.nextAction)?e.willAct.color=n:e.willAct.color=c.TRANSPARENT})),g("/unit/act",(function(t){if(t===e.model){var n=e.node.position.clone(),i=n.clone().add3f(0,-35,0);d(e.node).to(.06,{position:i},{easing:"cubicOut"}).to(.1,{position:n},{easing:"cubicIn"}).start()}})),g("/unit/death",(function(t){t===e.model&&(e.node.active=!1)})),g("/unit/health_lost",(function(t){if(console.log(t.unit.identifier,e.model.identifier),t.unit===e.model){var n,i;e.numberLabel.string=null!=(n=null==(i=t.damage.actual)?void 0:i.toString())?n:"-";var o=new c(20,20,20,255);e.numberBadge.color=o,e.scheduleOnce((function(){e.numberBadge.color=c.TRANSPARENT}),.2)}})),this.model&&this.sync()},r.onModelChanged=function(){this.hpOrb.norm=this.model.hpNorm},t}(u)).prototype,"position",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=t(C.prototype,"main",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=C))||w));r._RF.pop()}}}));

System.register("chunks:///_virtual/Weapons.ts",["cc","./Card.ts"],(function(e){var n,o,s;return{setters:[function(e){n=e.cclegacy},function(e){o=e.CardTemplate,s=e.simpleDamage}],execute:function(){n._RF.push({},"d0c60KUpjRPnLo2kj1ntLaz","Weapons",void 0);e("weapons",{broadsword:new o("broadsword",{rebound:!0}),fists:new o("punch",{rebound:!0}).with(s({d:4,bonus:-1}))});n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});